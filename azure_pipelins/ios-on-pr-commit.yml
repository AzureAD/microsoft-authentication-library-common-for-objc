trigger: none # Non-PR branches
pr:
  branches:
    include:
    - '*'

# This pipeline is not tagged as production, but the auto-injected Codesign Validation task takes ~3 minutes to
# configure itself, download all dependencies, and query for the classification tag of the pipeline before it determines
# it has nothing to do. Save this time by skipping that task.
variables:
  runCodesignValidationInjection: false

jobs:
- job: iOS_OnPrCommit
  displayName: iOS OnPRCommit
  pool:
    vmImage: macOS-10.15
  timeoutInMinutes: 40
  cancelTimeoutInMinutes: 1
  workspace:
    clean: all

  steps:
  - checkout: self
    clean: true
    fetchDepth: 1

  - template: templates/ios-setup.yml

  - template: templates/build-and-test.yml
    parameters:
      configuration: Debug
      platform: iOS
      arch: x64

  - template: templates/publish-logs.yml
    parameters:
      build: true
      testLogArtifactName: 'iOS Test Logs'
